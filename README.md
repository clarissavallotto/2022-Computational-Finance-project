# PreliminaryAnalyses.m

## Preliminary Analyses of Monthly Equity Indices in MATLAB

## Overview

This MATLAB project performs preliminary analyses on monthly equity index data from 2011 to 2022. The analyses include:

* Loading and preprocessing monthly price data.
* Plotting prices and returns of benchmark and 15 equity indices.
* Computing descriptive statistics and visualizing their evolution over time.
* Computing covariance matrices and standard deviations.
* Splitting the sample into subperiods to compare mean returns and volatilities.
* Handling a full benchmark series separately.

All results are saved for further analysis.

## Files Required

* **MATLAB.xlsx**: The Excel file containing the following sheets:

  * `MONTHLY`: Monthly price data for the benchmark and 15 equity indices (from 30/11/2011 to 30/11/2022).
  * `FB MONTHLY`: Full monthly benchmark series.

* **PreliminaryAnalyses.mat**: Workspace file generated after running the script.

* **TablesDescriptive.xlsx**: Excel file created by the script containing descriptive statistics for all indices.

## MATLAB Script

The main script performs the following tasks:

### 1. Load and Preprocess Data

* Reads `MONTHLY` and `FB MONTHLY` sheets from the Excel file.
* Converts date strings to MATLAB datetime format.
* Cleans the data by removing rows with missing values.

### 2. Plot Prices

* Plots the prices of the benchmark and 15 equity indices in a 4x4 subplot layout.
* Dates are displayed in `yyyy` format for clarity.

### 3. Compute and Plot Returns

* Computes monthly returns using the formula:

  $$
  r_t = \frac{P_t}{P_{t-1}} - 1
  $$
* Plots returns for all indices.

### 4. Descriptive Statistics

* Computes key statistics: mean, median, standard deviation, minimum, maximum, skewness, and kurtosis.
* Saves the results to `TablesDescriptive.xlsx`.

### 5. Aggregate Analysis

* Computes mean returns and standard deviations across the full sample.
* Visualizes them using bar plots.

### 6. Periodic Analysis

* Splits the sample into four subperiods:

  1. 2011–2014
  2. 2014–2017
  3. 2017–2020
  4. 2020–2022
* Computes mean returns and standard deviations for each subperiod.
* Visualizes the results in 2x2 subplot layouts.

### 7. Full Benchmark Analysis

* Loads the full benchmark series (`FB MONTHLY`).
* Computes returns for the full benchmark.

### 8. Save Workspace

* Saves the workspace to `PreliminaryAnalyses.mat`.

## Output

1. **Figures**:

   * Prices of all indices (4x4 subplots).
   * Returns of all indices (4x4 subplots).
   * Bar plots of mean returns and standard deviations (overall and by subperiod).

2. **Excel Tables**:

   * `TablesDescriptive.xlsx`: Descriptive statistics for all indices.

3. **MATLAB Workspace**:

   * `PreliminaryAnalyses.mat`: Contains all variables and results for further analysis.

## Usage

1. Ensure that `MATLAB.xlsx` is in the same directory as the script.
2. Run the script in MATLAB.
3. All figures will be displayed sequentially.
4. The workspace and tables will be saved automatically.

## Notes

* The script assumes 16 indices: a benchmark plus 15 national equity indices.
* Missing data rows are automatically removed before analysis.
* Dates are formatted as `dd/MM/yyyy` in all plots and tables.
* Standard deviations are derived from the covariance matrices of returns.

# StrategicAssetAllocation.m

## Strategic Asset Allocation with Monthly Data

## Overview

This MATLAB script implements **mean–variance portfolio optimization** and **CAPM-based equilibrium analysis** on the monthly equity index returns prepared in `PreliminaryAnalyses.m` (`PreliminaryAnalyses.mat`).
Key outputs include:

* Efficient frontiers (sample vs. equilibrium moments)
* Portfolio weights for unconstrained and no-short-selling cases
* Comparative analysis across two five-year windows

The script produces detailed plots of **risk–return trade-offs** and **asset allocations** under different assumptions.

## Prerequisites

* MATLAB R2020b or later (Financial Toolbox required for the `Portfolio` object)
* Files generated by `PreliminaryAnalyses.m`:

  * `PreliminaryAnalyses.mat` (workspace with variables `rm`, `lab`, `rBm`, etc.)

## Script Workflow

### 1. Load Data

```matlab
load 'PreliminaryAnalyses.mat';
```

Imports monthly return series (`rm`), benchmark return (`rBm`), and asset labels (`lab`) prepared in `PreliminaryAnalyses.m`.

### 2. Sample Moments (Last 5 Years)

* Compute mean (`MMrm5`) and covariance (`MVrm5`) of the 15 equity indices from **30/11/2017 – 30/11/2022**.
* Benchmark mean (`MMrB`) and variance (`MVrB`) for comparison.

#### Portfolio Construction

* **Unconstrained** (allows short selling) – `p1`
* **No Short Selling** – `p2`

Efficient portfolios computed:

* Global Minimum Variance (GMV)
* Maximum Sharpe Ratio (MS)
* Equally Weighted (EW)

#### Outputs

* Efficient frontier plots (risk vs. return)
* Stacked area charts of portfolio weights vs. **return** and **risk**

### 3. Equilibrium (CAPM) Moments

* Regress each asset’s returns on the **full benchmark series** to estimate:

  * Alpha, beta, residuals, $R^2$
  * CAPM-implied expected returns (`eqret`)
* Form equilibrium covariance matrix $MVe$.

#### Portfolios

* **Unconstrained** – `p3`
* **No Short Selling** – `p4`

Plots:

* Efficient frontiers for **sample** vs. **equilibrium** moments.
* Portfolio weights vs. return and risk.

### 4. Robustness Check – Alternate 5-Year Window

Period: **31/10/2012 – 31/10/2017**
The full process repeats:

* Compute sample moments (`MMrm52`, `MVrm52`)
* Estimate CAPM moments (`eqret3`, `MVe3`)
* Build portfolios (`p5`–`p8`) and plot:

  * Efficient frontiers
  * Portfolio weights (return & risk views)

## Key Variables

| Variable | Description                                |
| -------- | ------------------------------------------ |
| `rm`     | Monthly returns for benchmark + 15 indices |
| `lab`    | Asset labels (benchmark + country codes)   |
| `MMrm5`  | Mean returns (last 5 years)                |
| `MVrm5`  | Covariance matrix (last 5 years)           |
| `p1,p2`  | Portfolio objects (sample moments)         |
| `p3,p4`  | Portfolio objects (CAPM moments)           |
| `pwgt*`  | Portfolio weights for efficient portfolios |
| `pret*`  | Portfolio expected returns (frontier)      |
| `prsk*`  | Portfolio volatilities (frontier)          |

## Outputs

1. **Figures**

   * Efficient frontiers (sample vs. CAPM, constrained & unconstrained)
   * Benchmark and EW points
   * Portfolio composition by return and by volatility

2. **Workspace**

   * `StrategicAssetAllocation.mat` (all computed portfolios, weights, risks, returns)

## Usage

1. Ensure `PreliminaryAnalyses.mat` (from `PreliminaryAnalyses.m`) is in the same directory.
2. Run the script:

   ```matlab
   clear; clc;
   run('StrategicAssetAllocation.m');
   ```
3. Figures will display automatically.
4. Portfolio weights and frontiers can be reused by loading `StrategicAssetAllocation.mat`.

## Notes

* Benchmarks and assets are **monthly**, expressed in **percent returns**.
* Efficient frontiers are plotted for up to **100 portfolios** (`nport = 100`).
* Short-selling bounds for unconstrained cases are set at **–120%** (`setBounds(p, -1.2)`).
* CAPM regression uses `regstats` from the Statistics Toolbox.
* Axis limits (`xlim`, `ylim`) are adjusted for readability; modify if data ranges differ.

# --------------------------------------------------

# TacticalChoices.m

## Tactical Choices Portfolio Analysis (Monthly Data)

## Overview

This MATLAB project implements **tactical portfolio allocation strategies** using monthly financial data. The focus is on evaluating portfolio weights, realized returns, and cumulated returns under different constraints and estimation methods. The analysis considers **Global Minimum Variance (GMV)** and **Maximum Sharpe Ratio (MS)** portfolios using both **Sample Moments** and the **Exponentially Weighted Moving Average (EWMA)** method.

The code produces time-series of portfolio weights, plots their evolution, and computes cumulated returns for several portfolio strategies.

## Files

* `PreliminaryAnalyses.mat` – Input dataset containing returns and labels.
* `TacticalChoices.mat` – Output MATLAB workspace with computed portfolio weights, returns, and cumulated returns.

## Structure

### 1. Data Preparation

```matlab
load PreliminaryAnalyses.mat;
rI = rm(:, 2:16); % asset returns
rB = rm(:, 1);    % benchmark returns
[r, c] = size(rI);
w = 60;           % rolling window size
```

* The code extracts **asset returns** and **benchmark returns**.
* A **rolling window** of 60 months is used for calculating moving averages and covariances.


### 2. Estimation of Asset Moments

#### a) Sample Moments

* Rolling sample mean and covariance are calculated over the previous `w` months.

```matlab
MMS = zeros(r-w, c);
MVS = zeros(r-w, c, c);
```

#### b) EWMA Method

* Exponentially Weighted Moving Average with smoothing factor `λ = 0.95`.
* Provides forward-looking estimates for **mean returns** and **covariances**.

```matlab
EWMean = zeros(r-w, c);
EWVar = zeros(r-w, c, c);
```

### 3. Portfolio Construction

#### Portfolio 4–6: EWMA-Based Portfolios

1. **Portfolio 4** – No short selling, upper bound 13%.
2. **Portfolio 5** – Short selling allowed, group constraints:

   * Core, GIIPS, and Nordic country bounds.
3. **Portfolio 6** – Turnover constraints (maximum 5% allocation change per period).

#### Portfolio 7–9: Sample Moments-Based Portfolios

1. **Portfolio 7** – No short selling, upper bound 13%.
2. **Portfolio 8** – Short selling allowed, group constraints.
3. **Portfolio 9** – Turnover constraints.

**Portfolio methods implemented:**

* Global Minimum Variance (GMV)
* Maximum Sharpe Ratio (MS)

### 4. Portfolio Simulation

* Loop over time steps from `w+1` to `r`.
* At each step:

  1. Update asset moments (Sample or EWMA).
  2. Estimate GMV and MS portfolio weights.
  3. Apply constraints (short selling, upper/lower bounds, group constraints, turnover limits).
  4. Record **weights** and **realized returns**.

### 5. Visualization

* **Weights Evolution**: Area plots over time for GMV and MS portfolios under different strategies.
* **Cumulated Returns**: Line plots of cumulative performance over time.

**EWMA Method Example:**

```matlab
figure
sgtitle('EWMA METHOD')
subplot(3,2,1)
area(datenum(D(w+1:r,:)), squeeze(PortW_S4(1,:,:)));
title('No Short Selling and Upper Bound - GMV')
```

**Sample Moments Example:**

```matlab
figure
sgtitle('SAMPLE MOMENTS')
subplot(3,2,2)
area(datenum(D(w+1:r,:)), squeeze(PortW_S7(2,:,:)));
title('No Short Selling and Upper Bound - MS')
```

### 6. Output

* **Portfolio weights:** `PortW_S4`, `PortW_S5`, `PortW_S6`, `PortW_S7`, `PortW_S8`, `PortW_S9`
* **Realized returns:** `PortRet_S4`, `PortRet_S5`, `PortRet_S6`, `PortRet_S7`, `PortRet_S8`, `PortRet_S9`
* **Cumulated returns:** `CRS*` variables for all strategies
* Workspace saved as `TacticalChoices.mat`.

## Dependencies

* MATLAB R2022a or later.
* Financial Toolbox for `Portfolio` class and related functions.
* Input dataset: `PreliminaryAnalyses.mat`.

## Usage

1. Place `PreliminaryAnalyses.mat` in the working directory.
2. Run the script:

```matlab
run TacticalChoices.m
```

3. Inspect output variables and generated figures for portfolio weight evolution and cumulative returns.
4. Workspace is saved automatically to `TacticalChoices.mat`.

## Notes

* Turnover constraints are applied dynamically with a maximum adjustment of 5% per period; fallback strategies handle potential infeasibilities.
* Portfolio group constraints allow differentiation between country clusters (Core, GIIPS, Nordic).
* Code supports both **forward-looking EWMA estimates** and **rolling sample estimates** for robust analysis.


